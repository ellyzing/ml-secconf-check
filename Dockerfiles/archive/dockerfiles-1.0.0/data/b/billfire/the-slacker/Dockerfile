FROM openjdk:8  
ENV LEIN_VERSION=2.7.1  
ENV LEIN_INSTALL=/usr/local/bin/  
  
WORKDIR /tmp  
  
# Download the whole repo as an archive  
RUN mkdir -p $LEIN_INSTALL \  
&& wget -q
https://github.com/technomancy/leiningen/archive/$LEIN_VERSION.tar.gz \  
&& echo "Comparing archive checksum ..." \  
&& echo "876221e884780c865c2ce5c9aa5675a7cae9f215 *$LEIN_VERSION.tar.gz" |
sha1sum -c - \  
  
&& mkdir ./leiningen \  
&& tar -xzf $LEIN_VERSION.tar.gz -C ./leiningen/ --strip-components=1 \  
&& mv leiningen/bin/lein-pkg $LEIN_INSTALL/lein \  
&& rm -rf $LEIN_VERSION.tar.gz ./leiningen \  
  
&& chmod 0755 $LEIN_INSTALL/lein \  
  
# Download and verify Lein stand-alone jar  
&& wget -q
https://github.com/technomancy/leiningen/releases/download/$LEIN_VERSION/leiningen-$LEIN_VERSION-
standalone.zip \  
&& wget -q
https://github.com/technomancy/leiningen/releases/download/$LEIN_VERSION/leiningen-$LEIN_VERSION-
standalone.zip.asc \  
  
# Put the jar where lein script expects  
&& rm leiningen-$LEIN_VERSION-standalone.zip.asc \  
&& mkdir -p /usr/share/java \  
&& mv leiningen-$LEIN_VERSION-standalone.zip
/usr/share/java/leiningen-$LEIN_VERSION-standalone.jar  
  
ENV PATH=$PATH:$LEIN_INSTALL  
ENV LEIN_ROOT 1  
ADD / .  
  
RUN lein deps  

